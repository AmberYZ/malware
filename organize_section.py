'''
Helper script: re-order the section fields features
'''
import ConfigParser
from itertools import izip
import cPickle
import csv
import numpy as np
import os
import sys

filecount = 0
train_label = []
path_data = Config.get("Train","feature_save")
path_label = Config.get("Train","label")
path_save = Config.get("Train","model")

label_count = 0      
with open(path_label) as f:
    for line in f:
        label_count+=1
        line = line.split(".")
        train_label.append(line[0].strip()) 

data_name = []
data = []
header = []

linecount = 0
with open(os.path.join(path_data,"section_count"),"r") as ic:
    reader = csv.reader(ic, delimiter='\t')
    for line2 in reader:
        
        linecount += 1
        if(linecount==1):
            idx = line2.index("Filename")
            header = line2
            del header[idx]
            print(len(header))

        else:
            
            import_data = line2
            data_name.append(import_data[idx].strip())
            data_to_add = import_data
            del data_to_add[idx]
            data.append(data_to_add)
            if(len(data_to_add)!=len(header)):
                print(len(data_to_add))
                print(len(header))
                print(data_to_add)
                break
               
        if(linecount%1000==0):
            print(linecount)


label_idx = 0

writecount = 0
with open(os.path.join(path_save,"organized_section"),'wb+') as f:
    w = csv.writer(f,delimiter='\t')
    w.writerow(header)


for label_idx in range(len(train_label)):
    name = train_label[label_idx]
    idx = data_name.index(name)
    to_write = data[idx]

    with open(os.path.join(path_save,"organized_section"),'ab+') as f:
        w = csv.writer(f,delimiter='\t')
        w.writerow(to_write)
        writecount+=1
    print("Finish organizing: "+str(writecount)+" "+name + " "+data_name[idx])

    label_idx+=1
    
