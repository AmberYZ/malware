'''
Helper script: re-order the info fields features
'''
import ConfigParser
from itertools import izip
import cPickle
import csv
import numpy as np
import os
import string
import sys

filecount = 0
train_label = []
path_data = Config.get("Train","feature_save")
path_label = Config.get("Train","label")
path_save = Config.get("Train","model")

label_count = 0      
with open(path_label) as f:
    for line in f:
        label_count+=1
        line = line.split(".")
        train_label.append(line[0].strip()) 

data_name = []
data = []
header = []

linecount = 0
with open(os.path.join(path_data,"info.csv"),"r") as ic:
    for line2 in ic:
        linecount += 1
        if(linecount==1):
            header = line2.split(",")
            idx = header.index("Filename")
            del header[idx]

        else:
            import_data = line2.split(",")
            import_data[-1] = import_data[-1].strip()
            data_name.append(import_data[idx].strip())
            data_to_add = import_data
            del data_to_add[idx]
            data.append(data_to_add)
               
        if(linecount%1000==0):
            print(linecount)

print(len(data))

label_idx = 0
writecount = 0
with open(os.path.join(path_save,"organized_info.csv"),'wb+') as f:
    w = csv.writer(f)
    w.writerow(header)


for label_idx in range(len(train_label)):
    try:
        name = train_label[label_idx]
        idx = data_name.index(name)
        to_write = data[idx]
    except:
        to_write = [name,"Error"]
    
    with open(os.path.join(path_save,"organized_info.csv"),'ab+') as f:
        w = csv.writer(f)
        w.writerow(to_write)
        writecount+=1
    print("Finish organizing: "+str(writecount)+" "+name + " "+data_name[idx])

    label_idx+=1
    
